<script>
    function populate_target_markdown(label) {
        target_class = '#target-element-' + label;
        markdown_text = $('#' + label).val();
        var converter = new showdown.Converter();
        markdown_html = converter.makeHtml(markdown_text);
        $(target_class).html(markdown_html);
    }
</script>
<div class="{{ classname }}">
    {% if help_text %}
        <div class="object-help help">{{ help_text }}</div>
    {% endif %}

    <ul class="fields">
        {% for child in children.values %}
            <li{% if child.block.required %} class="required"{% endif %}>
                {% if child.block.label %}
                    <label{% if child.id_for_label %} for="{{ child.id_for_label }}"{% endif %}>{{ child.block.label }}:</label>
                {% endif %}
                {{ child.render_form }}
            </li>
            <li>
                <div id="target-element-{{ child.id_for_label }}" class="markdown-display-block"></div>
            </li>
            <script>
                populate_target_markdown('{{ child.id_for_label }}');

                $(document).ready(function() {
                    $('#{{ child.id_for_label }}').bind('input propertychange', function() {
                        populate_target_markdown('{{ child.id_for_label }}');
                    });
                });
            </script>
        {% endfor %}
    </ul>
</div>
